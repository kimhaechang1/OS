## 운영체제의 심장, 커널

운영채제의 핵심 서비스 (자원 할당 등)을 담당하는 부분을 커널이라고 한다.

운영체제에는 속하는데 커널에 속하지 않는 기능은 UI가 있다.

### 이중모드와 시스템 콜

사용자가 실행하는 프로그램은 자원에 직접 접근할 수 있을까?

- 자원의 직접접근은 위험하다.
    - 생각해보면 어떤 프로그램 A가 메모리 특정영역을 사용하고 있는데 프로그램 B가 해당 영역에 접근하여 지우면 프로그램이 정상적으로 실행되지 않는다.

따라서 운영체제는 응용프로그램들이 자원에 접근하려 할 때 오직 자신을 통해서만 접근하도록 하여 자원을 보호

-> 이를 구현한 것이 이중모드 라고 한다.

**이중모드**: CPU가 명령어를 실행하는 모드를 크게 사용자 모드와 커널 모드로 구분하는 방식

- 사용자 모드
    - 운영체제 서비스를 제공받을 수 없는 모드, 즉 자원 접근 X
    - 사용자모드에서 자원에 접근하려하면 오류를 일으킨다.

- 커널 모드
    - 운영체제의 서비스를 제공받을 수 있는 실행모드, 즉 자원 접근 O

작동원리로는 어떤 자원에 접근하는 명령어가 CPU에 도착했을 때 

현재 CPU의 플래그(상태) 레지스터 내부 수퍼바이저 플래그가 켜져있으면 커널모드로 사용이 가능하므로 실행하고, 꺼져있으면 사용자모드이므로 실행하지 못한다.

그러면 어떻게 모드를 전환할까?

이는 **시스템 콜**에 의해 모드를 커널모드로 전환할 수 있다.(일종의 인터럽트)

```
그래서 어떤 자원을 사용해야하는 상황이 오면 해당 응용프로그램이 시스템 콜을 통해 CPU의 수퍼바이저 플래그를 켜서 커널모드로 진입할 수 있게 요청하고 관련된 인터럽트 헨들링에 의해 자원을 배정받아 처리한 후 다시 사용자 모드로 돌아간다.
```